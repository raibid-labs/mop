apiVersion: v1
kind: ConfigMap
metadata:
  name: obi
  namespace: observability-dev
  labels:
    app: obi
    component: ebpf-instrumentation
data:
  config.yaml: |
    exporters:
      otlp:
        endpoint: alloy.observability-dev.svc.cluster.local:4317
        insecure: true
        headers:
          x-service: obi
          x-namespace: observability-dev
    processors:
      batch:
        timeout: 5s
        send_batch_size: 100
      resource:
        attributes:
        - key: service.name
          value: obi
          action: insert
        - key: service.namespace
          value: observability-dev
          action: insert
        - key: telemetry.sdk.name
          value: obi-ebpf
          action: insert
    receivers:
      ebpf:
        protocols:
        - HTTP
        - gRPC
        - SQL
        - Redis
        - Kafka
        syscalls: true
        network: true
        tcp: true
        udp: true
        sampling_rate: 1.0
    service:
      pipelines:
        traces:
          receivers: [ebpf]
          processors: [batch, resource]
          exporters: [otlp]
        metrics:
          receivers: [ebpf]
          processors: [batch, resource]
          exporters: [otlp]
        logs:
          receivers: [ebpf]
          processors: [batch, resource]
          exporters: [otlp]
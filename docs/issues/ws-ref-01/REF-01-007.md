# REF-01-007: HTTP REST API - Documentation

## Context
Create comprehensive documentation for the HTTP REST API example, explaining the architecture, OBI instrumentation points, deployment process, and troubleshooting. This documentation serves as a guide for users understanding how OBI automatically instruments HTTP services.

## Requirements
- [ ] Update main README with complete project overview
- [ ] Document all API endpoints with examples
- [ ] Create OBI instrumentation guide for HTTP protocol
- [ ] Document deployment process step-by-step
- [ ] Add troubleshooting section with common issues
- [ ] Document environment variables and configuration
- [ ] Create architecture diagram (components, data flow)
- [ ] Add code examples for common use cases
- [ ] Document testing procedures
- [ ] Add performance benchmarks and OBI overhead

## Acceptance Criteria
1. README is complete and well-organized
2. API endpoints documented with curl examples
3. OBI instrumentation points clearly explained
4. Deployment instructions work from scratch
5. Troubleshooting section covers common scenarios
6. Configuration options fully documented
7. Architecture diagram shows component relationships
8. Code examples are runnable and correct
9. Testing procedures are reproducible
10. Documentation passes technical review

## Clarifying Questions

**Q1: What level of detail should the documentation have?**
- Context: Balance between completeness and readability
- Options:
  - A) High-level overview only
  - B) Detailed technical documentation
  - C) Both (overview + deep dive sections)
- Default: Both - quick start + detailed sections

**Q2: Should we include video/screencast content?**
- Context: Different learning styles
- Options:
  - A) Text and images only
  - B) Add optional video walkthroughs
  - C) Interactive tutorials
- Default: Text and images (video optional in REF-07-006)

**Q3: How should we document OBI internals?**
- Context: User knowledge level
- Options:
  - A) Black box (what it does, not how)
  - B) White box (explain eBPF internals)
  - C) Hybrid (high-level + optional deep dive)
- Default: Hybrid approach for flexibility

**Q4: Should we include performance comparison data?**
- Context: OBI overhead demonstration
- Options:
  - A) Yes, with/without OBI comparison
  - B) Qualitative only (<1% overhead)
  - C) Link to separate benchmarks
- Default: Include summary data, link to detailed benchmarks

## Technical Notes

### Files to Create/Update
```
examples/01-http-api/
├── README.md                    # Main documentation (update)
├── docs/
│   ├── API.md                   # API endpoint reference
│   ├── ARCHITECTURE.md          # Architecture and design
│   ├── DEPLOYMENT.md            # Deployment guide
│   └── TROUBLESHOOTING.md       # Common issues and solutions
docs/examples/
└── http-instrumentation.md      # OBI HTTP instrumentation guide
```

### README Structure
```markdown
# HTTP REST API Example - Product Catalog

## Overview
Brief description of the example and its purpose.

## Quick Start
```bash
# Clone repository
git clone ...

# Build and run
make docker-build
kubectl apply -f deployments/examples/01-http-api/

# Test the API
curl http://localhost:8080/products
```

## Features
- CRUD operations for products
- Pagination and search
- Rate limiting
- Error scenarios
- OBI automatic instrumentation

## Architecture
[Diagram showing components]

## API Reference
See [docs/API.md](docs/API.md) for detailed endpoint documentation.

## OBI Instrumentation
This example demonstrates zero-code HTTP instrumentation. See [HTTP Instrumentation Guide](../../docs/examples/http-instrumentation.md).

## Development
[Build, test, lint instructions]

## Deployment
See [docs/DEPLOYMENT.md](docs/DEPLOYMENT.md) for Kubernetes deployment.

## Troubleshooting
See [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md) for common issues.

## Performance
Baseline performance:
- RPS: 10,000+ requests/sec
- p99 latency: <10ms
- OBI overhead: <1% CPU

## License
[License information]
```

### API Documentation (docs/API.md)
```markdown
# API Reference

## Endpoints

### GET /products
List all products with pagination.

**Query Parameters:**
- `limit` (int, default: 10) - Number of results
- `offset` (int, default: 0) - Offset for pagination

**Example:**
```bash
curl http://localhost:8080/products?limit=5&offset=10
```

**Response:**
```json
{
  "products": [...],
  "total": 100,
  "limit": 5,
  "offset": 10
}
```

### POST /products
Create a new product.

**Request Body:**
```json
{
  "name": "Product Name",
  "description": "Product description",
  "price": 99.99,
  "stock": 100
}
```

**Example:**
```bash
curl -X POST http://localhost:8080/products \
  -H "Content-Type: application/json" \
  -d '{"name":"Widget","price":29.99,"stock":50}'
```

[Continue for all endpoints...]
```

### OBI Instrumentation Guide (docs/examples/http-instrumentation.md)
```markdown
# OBI HTTP Instrumentation Guide

## Overview
OBI automatically instruments HTTP services using eBPF, capturing requests, responses, and metadata without any code changes.

## What OBI Captures

### Request Data
- HTTP method (GET, POST, etc.)
- URL path and query parameters
- Request headers
- Request body size
- Client IP address
- Timestamp

### Response Data
- HTTP status code
- Response headers
- Response body size
- Duration (ms)
- Error details (if any)

## Instrumentation Points

### 1. HTTP Request Initiation
When a request arrives, OBI:
1. Captures socket connection details
2. Parses HTTP headers
3. Creates trace span
4. Assigns trace ID and span ID

### 2. Handler Execution
OBI tracks:
- Handler start time
- Middleware execution
- Database queries (if any)
- External API calls

### 3. HTTP Response
OBI captures:
- Response status code
- Response headers
- Response body size
- Total duration
- Closes trace span

## Viewing Traces

Traces appear in Grafana with:
- Service name: `http-api`
- Operation: `HTTP {METHOD} {PATH}`
- Tags: method, path, status_code, error
- Duration in milliseconds

## Performance Impact

OBI's eBPF instrumentation has minimal overhead:
- CPU: <0.5% per service
- Memory: <50MB per agent
- Latency: <100μs per request

## Zero Code Changes

This example has **no instrumentation code**:
- No SDK imports
- No tracing libraries
- No manual span creation
- Pure business logic

OBI handles everything automatically via eBPF.
```

### Deployment Guide (docs/DEPLOYMENT.md)
```markdown
# Deployment Guide

## Prerequisites
- Kubernetes cluster (1.23+)
- kubectl configured
- OBI agent deployed

## Step-by-Step Deployment

### 1. Build Docker Image
```bash
cd examples/01-http-api
make docker-build
docker tag http-api:latest your-registry/http-api:latest
docker push your-registry/http-api:latest
```

### 2. Update Image in Manifests
Edit `deployments/examples/01-http-api/deployment.yaml`:
```yaml
image: your-registry/http-api:latest
```

### 3. Apply Kubernetes Manifests
```bash
kubectl apply -f deployments/examples/01-http-api/
```

### 4. Verify Deployment
```bash
kubectl get pods -l app=http-api
kubectl logs -l app=http-api
```

### 5. Test API
```bash
kubectl port-forward svc/http-api 8080:80
curl http://localhost:8080/health
```

### 6. Verify OBI Instrumentation
Check Grafana dashboard or query traces:
```bash
# Check OBI agent logs
kubectl logs -l app=obi-agent | grep http-api

# View traces in Grafana
# Navigate to Explore > Tempo > Service: http-api
```

## Configuration

See ConfigMap for configuration options:
```yaml
APP_NAME: "product-catalog"
LOG_LEVEL: "info"
RATE_LIMIT_RPS: "100"
```

## Scaling

Horizontal Pod Autoscaler is configured:
```bash
kubectl get hpa http-api-hpa
```

## Troubleshooting

See [TROUBLESHOOTING.md](TROUBLESHOOTING.md).
```

### Troubleshooting Guide
```markdown
# Troubleshooting Guide

## Issue: Pods Not Starting

**Symptoms:**
- Pods stuck in Pending or CrashLoopBackOff
- `kubectl get pods` shows errors

**Solutions:**
1. Check pod logs: `kubectl logs <pod-name>`
2. Describe pod: `kubectl describe pod <pod-name>`
3. Verify image exists: `docker pull <image>`
4. Check resource limits: nodes have enough CPU/memory

## Issue: OBI Not Capturing Traces

**Symptoms:**
- No traces in Grafana
- OBI agent logs show no activity

**Solutions:**
1. Verify OBI annotations on deployment
2. Check OBI agent is running: `kubectl get pods -l app=obi-agent`
3. Verify network policies allow OBI access
4. Check Grafana data source configuration

[Continue with more scenarios...]
```

### Testing Approach
- Review documentation for completeness
- Follow deployment guide from scratch
- Test all curl examples
- Verify links work
- Check diagrams render correctly
- Get feedback from technical reviewers

### Dependencies
- Completed code from REF-01-001 through REF-01-006
- Deployed application for screenshot/examples
- OBI agent for instrumentation examples

### Integration Points
- Referenced by other workstream docs
- Linked from main MOP documentation
- Used in REF-07-003 (instrumentation guide compilation)
- Feeds into REF-07-004 (troubleshooting scenarios)

## Definition of Done
- [ ] README is comprehensive and well-structured
- [ ] API documentation covers all endpoints with examples
- [ ] OBI instrumentation guide explains automatic capture
- [ ] Deployment guide tested from scratch
- [ ] Troubleshooting section covers common issues
- [ ] Architecture diagram created and included
- [ ] All curl examples tested and working
- [ ] Configuration options documented
- [ ] Performance benchmarks included
- [ ] All links working and documents render correctly
- [ ] Technical review completed with feedback incorporated
- [ ] Code examples tested and verified
- [ ] PR merged to main branch

## Related Issues
- Blocked by: REF-01-001 through REF-01-006 (needs complete implementation)
- Related: REF-07-003 (OBI instrumentation compilation)
- Related: REF-07-004 (troubleshooting guide)
- Related: REF-07-005 (load testing guide)

## Labels
`workstream:ws-ref-01`, `priority:medium`, `status:new`, `type:documentation`, `protocol:http`
